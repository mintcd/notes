/* ===== Theme primitives ===== */
:root {
  /* colors */
  --bg: #f7f7fb;
  --fg: #121418;
  --muted: #5b6270;
  --rule: #e4e6ee;

  /* accents */
  --accent: #2563eb;
  --accent-2: #16a34a;

  /* layout */
  --maxw: 68ch;

  /* TOC */
  --tocw: 280px;
  --toc-gap: 28px;

  /* effects */
  --radius: 12px;
  --shadow: 0 6px 20px rgba(0,0,0,.06);
}

@media (prefers-color-scheme: dark) {
  :root:not([data-theme]) {
    --bg: #0e1116;
    --fg: #e8eaf0;
    --muted: #a2a9b5;
    --rule: #272c35;
    --shadow: 0 6px 20px rgba(0,0,0,.35);
  }
}

/* Explicit override when user chose dark */
:root[data-theme="dark"] {
  --bg: #0e1116;
  --fg: #e8eaf0;
  --muted: #a2a9b5;
  --rule: #272c35;
  --shadow: 0 6px 20px rgba(0,0,0,.35);
}

/* Smooth theme transition */
html, body {
  background: var(--bg);
  color: var(--fg);
  transition: background-color .25s ease, color .25s ease;
}

/* ===== Base layout / typography ===== */
body {
  margin: 0 auto;
  max-width: var(--maxw);
  padding: 42px 20px 80px;
  line-height: 1.6;
  font: 16px/1.6 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
}

@media (min-width: 1000px) {
  body { max-width: calc(var(--maxw) + var(--tocw) + var(--toc-gap)); }
}

img, svg { max-width: 100%; height: auto; }

/* headings */
h1, h2, h3, h4 { scroll-margin-top: 3rem; }
h1 { font-size: 1.9rem; margin-top: 1.2em; }
h2 { font-size: 1.5rem; margin-top: 1.1em; }
h3 { font-size: 1.25rem; margin-top: 1em; }
.header-section-number { color: var(--muted); margin-right: .45rem; }

/* links */
a { color: inherit; text-decoration-color: color-mix(in oklab, var(--fg), transparent 70%); }
a:hover { text-decoration-color: currentColor; }

/* code */
pre { background: color-mix(in oklab, var(--fg), transparent 90%); padding: 12px 14px; border-radius: var(--radius); overflow: auto; box-shadow: var(--shadow); }
code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }

/* KaTeX tweaks */
.katex-display { margin: .8rem 0; }
.katex-display > .katex { text-align: left; }

/* ===== Theorem-like blocks (use your data-kind/data-number) ===== */
.theorem,.lemma,.proposition,.corollary,.definition,.example,.remark,.proof,.frame{
  border: 1px solid var(--rule);
  border-left: 4px solid var(--accent);
  border-radius: var(--radius);
  padding: 12px 14px;
  margin: 1rem 0;
  background: color-mix(in oklab, var(--bg), var(--fg) 4%);
  box-shadow: var(--shadow);
}
.definition { border-left-color: var(--accent-2); }
.lemma { border-left-color: #7c3aed; }
.proposition { border-left-color: #ea580c; }
.corollary { border-left-color: #db2777; }
.example { border-left-color: #0891b2; }
.remark { border-left-color: #6b7280; }
.proof { border-left-color: #111827; }

.theorem::before { content: "Theorem " attr(data-number) "."; }
.definition::before { content: "Definition " attr(data-number) "."; }
.lemma::before     { content: "Lemma " attr(data-number) "."; }
.corollary::before { content: "Corollary " attr(data-number) "."; }
.example::before   { content: "Example " attr(data-number) "."; }
.remark::before    { content: "Remark " attr(data-number) "."; }

.theorem::before,.definition::before,.lemma::before,.proposition::before,
.corollary::before,.example::before,.remark::before{
  display: inline-block;
  font-weight: 600;
  color: var(--muted);
  margin-right: .5rem;
  letter-spacing: .02em;
  font-size: .9em;
}
.proof::before { text-transform: none; }

/* ===== TOC sidebar / dropdown ===== */
.toc-sidebar {
  margin: 0 0 1rem;
  user-select: none;
}
@media (min-width: 1000px) {
  .toc-sidebar {
    float: left;
    width: var(--tocw);
    margin-right: var(--toc-gap);
    position: sticky;
    top: 24px;
  }
}

.toc-card {
  border: 1px solid var(--rule);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  background: var(--bg);
  overflow: hidden;
}

.toc-header {
  display: flex;
  align-items: center;
  gap: .6rem;
  padding: 10px 12px;
  font-weight: 700;
  cursor: pointer;
}

.toc-caret {
  width: 1em; height: 1em; display: inline-block;
  transition: transform .2s ease;
  transform: rotate(-90deg);
}
.toc-open .toc-caret { transform: rotate(0deg); }

.toc-content {
  /* Animated open/close with JS controlling height */
  height: 0;
  overflow: hidden;
  transition: height .22s ease;
  border-top: 1px solid var(--rule);
}

.toc-inner {
  padding: 8px 12px;
}
.toc-inner ul { padding-left: 1.1em; margin: .35rem 0; }
.toc-inner li { margin: .15rem 0; }
.toc-inner a { text-decoration: none; }
.toc-inner a:hover { text-decoration: underline; }

/* Active anchor highlight (when JS sets .is-active) */
.toc-inner a.is-active { color: var(--accent); font-weight: 600; }

/* ===== Theme toggle button ===== */
.theme-toggle {
  position: fixed;
  right: 16px;
  bottom: 16px;
  z-index: 999;
  border: 1px solid var(--rule);
  background: var(--bg);
  color: var(--fg);
  border-radius: 999px;
  padding: 8px 12px;
  box-shadow: var(--shadow);
  cursor: pointer;
  display: inline-flex; align-items: center; gap: .5rem;
  font-weight: 600;
}
.theme-toggle:hover { filter: brightness(1.02); }

/* Heading anchors (Â¶) */
.anchor { visibility: hidden; margin-left: .4em; opacity: .7; text-decoration: none; }
h1:hover .anchor, h2:hover .anchor, h3:hover .anchor, h4:hover .anchor { visibility: visible; }
